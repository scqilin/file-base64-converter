<!DOCTYPE html>
<html>
  <head>
    <title>æ–‡ä»¶Base64è½¬æ¢å·¥å…·é›†åˆ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        height: 100vh;
        overflow: hidden;
      }

      .app-container {
        display: flex;
        height: 100vh;
      }

      /* å·¦ä¾§å¯¼èˆªæ  */
      .sidebar {
        width: 280px;
        background: #2c3e50;
        color: white;
        display: flex;
        flex-direction: column;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      }

      .sidebar-header {
        padding: 20px;
        background: #34495e;
        border-bottom: 1px solid #1a252f;
      }

      .sidebar-header h1 {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .sidebar-header p {
        font-size: 12px;
        color: #bdc3c7;
      }

      .nav-menu {
        flex: 1;
        padding: 20px 0;
      }

      .nav-category {
        margin-bottom: 25px;
      }

      .nav-category-title {
        padding: 0 20px 10px;
        font-size: 12px;
        color: #bdc3c7;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: bold;
      }

      .nav-item {
        display: flex;
        align-items: center;
        padding: 8px 20px;
        color: #ecf0f1;
        text-decoration: none;
        transition: all 0.3s;
        border-left: 4px solid transparent;
        cursor: pointer;
        position: relative;
      }

      .nav-item:hover {
        background: #34495e;
        border-left-color: #3498db;
      }

      .nav-item.active {
        background: #34495e;
        border-left-color: #e74c3c;
        color: white;
      }

      .nav-item .icon {
        font-size: 16px;
        width: 20px;
        margin-right: 12px;
        text-align: center;
        flex-shrink: 0;
        align-self: flex-start;
        margin-top: 2px;
      }

      .nav-item .text-content {
        flex: 1;
        min-width: 0;
      }

      .nav-item .title {
        font-size: 14px;
        font-weight: 500;
        display: block;
        line-height: 1.3;
        margin-bottom: 1px;
      }

      .nav-item .subtitle {
        font-size: 11px;
        color: #bdc3c7;
        display: block;
        line-height: 1.2;
        opacity: 0.8;
      }

      /* ä¾§è¾¹æ åº•éƒ¨ */
      .sidebar-footer {
        padding: 20px;
        border-top: 1px solid #1a252f;
        background: #34495e;
      }

      .github-link {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        color: #ecf0f1;
        text-decoration: none;
        border-radius: 6px;
        transition: all 0.3s;
        background: #2c3e50;
        border: 1px solid #34495e;
      }

      .github-link:hover {
        background: #3498db;
        border-color: #3498db;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
      }

      .github-link .icon {
        font-size: 16px;
        margin-right: 10px;
      }

      .github-link .text {
        font-size: 12px;
        font-weight: 500;
      }

      /* ä¸»å†…å®¹åŒºåŸŸ */
      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .content-header {
        background: white;
        padding: 20px 30px;
        border-bottom: 1px solid #e9ecef;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .content-header h2 {
        font-size: 24px;
        color: #2c3e50;
        margin-bottom: 5px;
      }

      .content-header p {
        color: #7f8c8d;
        font-size: 14px;
      }

      .content-body {
        flex: 1;
        padding: 30px;
        overflow-y: auto;
        background: #f8f9fa;
      }

      .tool-container {
        display: none;
        max-width: 1400px;
        margin: 0 auto;
      }

      .tool-container.active {
        display: block;
      }

      /* å“åº”å¼å¹¶æ’å¸ƒå±€ */
      @media (min-width: 1200px) {
        .tool-container.active {
          display: flex;
          gap: 30px;
          align-items: flex-start;
        }

        .tool-section {
          flex: 1;
          margin-bottom: 0;
          height: fit-content;
        }
      }

      /* ä¸­ç­‰å±å¹•ä¿æŒä¸Šä¸‹å¸ƒå±€ */
      @media (max-width: 1199px) {
        .tool-container.active {
          display: block;
        }
      }

      .tool-section {
        background: white;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .section-title {
        font-size: 18px;
        color: #2c3e50;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #ecf0f1;
      }

      /* è¡¨å•å…ƒç´ æ ·å¼ */
      textarea {
        width: 100%;
        height: 200px;
        padding: 15px;
        border: 2px solid #e9ecef;
        border-radius: 6px;
        font-family: 'Courier New', monospace;
        font-size: 13px;
        resize: none;
        margin-bottom: 20px;
        transition: border-color 0.3s;
      }

      textarea:focus {
        outline: none;
        border-color: #3498db;
      }

      /* åœ¨å¹¶æ’å¸ƒå±€æ—¶è°ƒæ•´textareaé«˜åº¦ */
      @media (min-width: 1200px) {
        textarea {
          height: 180px;
        }
        
        .file-info {
          max-height: 200px;
          overflow-y: auto;
        }
      }

      .form-group {
        margin-bottom: 20px;
      }

      .button-group {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        align-items: center;
      }

      button,
      .file-upload-button {
        padding: 12px 20px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        min-height: 44px;
      }

      button:hover,
      .file-upload-button:hover {
        background: #2980b9;
        transform: translateY(-1px);
      }

      button.success {
        background: #27ae60;
      }

      button.success:hover {
        background: #229954;
      }

      button.danger {
        background: #e74c3c;
      }

      button.danger:hover {
        background: #c0392b;
      }

      button:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
        transform: none;
      }

      .file-input {
        display: none;
      }

      /* æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º */
      .file-info {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 6px;
        padding: 20px;
        margin-bottom: 20px;
        min-height: 120px;
        display: none;
      }

      .file-info.show {
        display: block;
      }

      .file-info h3 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 16px;
      }

      .file-info-item {
        margin-bottom: 10px;
        color: #5a6c7d;
        font-size: 14px;
      }

      .file-info-item strong {
        color: #2c3e50;
        margin-right: 10px;
      }

      .info-text {
        background: #e8f4f8;
        border-left: 4px solid #3498db;
        padding: 15px;
        color: #2c3e50;
        font-size: 13px;
        line-height: 1.6;
        border-radius: 0 6px 6px 0;
      }

      .no-file {
        text-align: center;
        color: #7f8c8d;
        padding: 30px;
      }

      .file-icon {
        font-size: 48px;
        margin-bottom: 10px;
      }

      /* .stats-row {
        display: flex;
        gap: 15px;
        align-items: center;
        font-size: 14px;
        color: #5a6c7d;
      }

      .stat-item {
        background: #f8f9fa;
        padding: 8px 12px;
        border-radius: 4px;
        border: 1px solid #e9ecef;
      } */

      /* Toastæç¤º */
      .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #2c3e50;
        color: white;
        padding: 15px 20px;
        border-radius: 6px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
      }

      .toast.show {
        opacity: 1;
        transform: translateX(0);
      }

      .toast.success {
        background: #27ae60;
      }

      .toast.error {
        background: #e74c3c;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .sidebar {
          width: 100%;
          position: fixed;
          z-index: 1000;
          transform: translateX(-100%);
          transition: transform 0.3s;
        }

        .sidebar.show {
          transform: translateX(0);
        }

        .main-content {
          width: 100%;
        }

        .content-body {
          padding: 20px;
        }

        .button-group {
          flex-direction: column;
          align-items: stretch;
        }

        /* ç§»åŠ¨ç«¯å¼ºåˆ¶ä¸Šä¸‹å¸ƒå±€ */
        .tool-container.active {
          display: block !important;
        }

        .tool-section {
          flex: none !important;
          margin-bottom: 25px !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- å·¦ä¾§å¯¼èˆªæ  -->
      <nav class="sidebar">
        <div class="sidebar-header">
          <h1>æ–‡ä»¶Base64è½¬æ¢å·¥å…·é›†</h1>
          <p>ç¦»çº¿ç‰ˆæœ¬ - ä¿æŠ¤æ‚¨çš„éšç§</p>
        </div>
        
        <div class="nav-menu">
          <div class="nav-category">
            <div class="nav-category-title">Base64 è½¬æ¢</div>
            
            <a class="nav-item active" onclick="switchTool('image-to-base64')">
              <span class="icon">ğŸ–¼ï¸</span>
              <div class="text-content">
                <span class="title">å›¾ç‰‡è½¬æ¢</span>
                <span class="subtitle">å›¾ç‰‡ â†” Base64</span>
              </div>
            </a>
            
            <a class="nav-item" onclick="switchTool('archive-to-base64')">
              <span class="icon">ğŸ“¦</span>
              <div class="text-content">
                <span class="title">å‹ç¼©æ–‡ä»¶è½¬æ¢</span>
                <span class="subtitle">ZIP/RAR/7Z â†” Base64</span>
              </div>
            </a>
          </div>

          <div class="nav-category">
            <div class="nav-category-title">å³å°†æ¨å‡º</div>
            
            <a class="nav-item" style="opacity: 0.5; cursor: not-allowed;">
              <span class="icon">ğŸ“„</span>
              <div class="text-content">
                <span class="title">æ–‡æ¡£è½¬æ¢</span>
                <span class="subtitle">PDF/Word â†” Base64</span>
              </div>
            </a>
            
            <a class="nav-item" style="opacity: 0.5; cursor: not-allowed;">
              <span class="icon">ğŸµ</span>
              <div class="text-content">
                <span class="title">éŸ³é¢‘è½¬æ¢</span>
                <span class="subtitle">MP3/WAV â†” Base64</span>
              </div>
            </a>
          </div>
        </div>
        
        <div class="sidebar-footer">
          <a href="https://github.com/scqilin/file-base64-converter" target="_blank" class="github-link">
            <span class="icon">â­</span>
            <span class="text">GitHub é¡¹ç›®åœ°å€</span>
          </a>
        </div>
      </nav>

      <!-- ä¸»å†…å®¹åŒºåŸŸ -->
      <main class="main-content">
        <div class="content-header">
          <h2 id="current-tool-title">å›¾ç‰‡è½¬æ¢å·¥å…·</h2>
          <p id="current-tool-description">æ”¯æŒJPGã€PNGã€GIFç­‰å¸¸è§å›¾ç‰‡æ ¼å¼ä¸Base64ä¹‹é—´çš„ç›¸äº’è½¬æ¢</p>
        </div>

        <div class="content-body">
          <!-- å›¾ç‰‡è½¬æ¢å·¥å…· -->
          <div id="image-to-base64" class="tool-container active">
            <!-- å›¾ç‰‡è½¬Base64 -->
            <div class="tool-section">
              <h3 class="section-title">ğŸ–¼ï¸ å›¾ç‰‡ â†’ Base64</h3>
              
              <textarea id="imageBase64Output" placeholder="Base64ç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ" readonly></textarea>
              
              <div class="button-group">
                <label class="file-upload-button">
                  <span>ğŸ“</span>
                  ä¸Šä¼ å›¾ç‰‡
                  <input type="file" class="file-input" id="imageFileInput" accept="image/*" />
                </label>
                <button onclick="pasteImageFromClipboard()">
                  <span>ğŸ“‹</span>
                  ç²˜è´´å›¾ç‰‡
                </button>
                <button class="success" onclick="copyImageBase64()">
                  <span>ğŸ“‹</span>
                  å¤åˆ¶Base64
                </button>
                <button class="danger" onclick="clearImageBase64()">
                  <span>ğŸ—‘ï¸</span>
                  æ¸…é™¤
                </button>
              </div>

              <div id="imageFileInfo" class="file-info">
                <div class="no-file">
                  <div class="file-icon">ğŸ–¼ï¸</div>
                  <p>è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶</p>
                </div>
              </div>

              <div class="info-text">
                <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                1. ç‚¹å‡»"ä¸Šä¼ å›¾ç‰‡"é€‰æ‹©æ–‡ä»¶ï¼Œæˆ–ç‚¹å‡»"ç²˜è´´å›¾ç‰‡"ä»å‰ªè´´æ¿è·å–<br>
                2. æ”¯æŒ JPGã€PNGã€GIFã€BMPã€WebP ç­‰å¸¸è§æ ¼å¼<br>
                3. è‡ªåŠ¨è½¬æ¢ä¸ºBase64æ ¼å¼ï¼Œå¹¶ä¿ç•™åŸå§‹æ–‡ä»¶åä¿¡æ¯<br>
                4. è½¬æ¢çš„Base64åŒ…å«æ–‡ä»¶åï¼Œè¿˜åŸæ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨åŸå§‹æ–‡ä»¶å<br>
                5. æ‰€æœ‰å¤„ç†éƒ½åœ¨æœ¬åœ°å®Œæˆï¼Œç¡®ä¿æ–‡ä»¶å®‰å…¨
              </div>
            </div>

            <!-- Base64è½¬å›¾ç‰‡ -->
            <div class="tool-section">
              <h3 class="section-title">ğŸ”„ Base64 â†’ å›¾ç‰‡</h3>
              
              <textarea id="imageBase64Input" placeholder="ç²˜è´´å›¾ç‰‡çš„Base64ç¼–ç ï¼ˆå¦‚ï¼šdata:image/png;base64,...)"></textarea>
              
              <div class="button-group">
                <button onclick="pasteImageBase64()">
                  <span>ğŸ“‹</span>
                  ç²˜è´´Base64
                </button>
                <button onclick="convertBase64ToImage()">
                  <span>ğŸ”„</span>
                  è½¬æ¢ä¸ºå›¾ç‰‡
                </button>
                <button id="downloadImageBtn" class="success" disabled onclick="downloadImage()">
                  <span>ğŸ’¾</span>
                  ä¸‹è½½å›¾ç‰‡
                </button>
                <button class="danger" onclick="clearImageConvert()">
                  <span>ğŸ—‘ï¸</span>
                  æ¸…é™¤
                </button>
              </div>

              <div id="imagePreview" class="file-info">
                <div class="no-file">
                  <div class="file-icon">ğŸ–¼ï¸</div>
                  <p>å›¾ç‰‡é¢„è§ˆåŒºåŸŸ</p>
                </div>
              </div>

              <div class="info-text">
                <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                1. ç²˜è´´åŒ…å«å®Œæ•´data:imageå‰ç¼€çš„Base64ç¼–ç <br>
                2. å¦‚æœBase64åŒ…å«æ–‡ä»¶åä¿¡æ¯ï¼Œä¼šè‡ªåŠ¨è¯†åˆ«å¹¶æ˜¾ç¤ºåŸå§‹æ–‡ä»¶å<br>
                3. ç‚¹å‡»"è½¬æ¢ä¸ºå›¾ç‰‡"ç”Ÿæˆé¢„è§ˆ<br>
                4. ç¡®è®¤æ— è¯¯åç‚¹å‡»"ä¸‹è½½å›¾ç‰‡"ä¿å­˜åˆ°æœ¬åœ°ï¼ˆä½¿ç”¨åŸå§‹æ–‡ä»¶åï¼‰<br>
                5. æ”¯æŒè‡ªåŠ¨è¯†åˆ«å›¾ç‰‡æ ¼å¼å¹¶è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æ‰©å±•å
              </div>
            </div>
          </div>

          <!-- å‹ç¼©æ–‡ä»¶è½¬æ¢å·¥å…· -->
          <div id="archive-to-base64" class="tool-container">
            <!-- å‹ç¼©æ–‡ä»¶è½¬Base64 -->
            <div class="tool-section">
              <h3 class="section-title">ğŸ“¦ å‹ç¼©æ–‡ä»¶ â†’ Base64</h3>
              
              <textarea id="archiveBase64Output" placeholder="Base64ç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ" readonly></textarea>
              
              <div class="button-group">
                <label class="file-upload-button">
                  <span>ğŸ“</span>
                  ä¸Šä¼ å‹ç¼©æ–‡ä»¶
                  <input type="file" class="file-input" id="archiveFileInput" accept=".zip,.rar,.7z,.tar,.gz,.bz2,.xz" />
                </label>
                <button class="success" onclick="copyArchiveBase64()">
                  <span>ğŸ“‹</span>
                  å¤åˆ¶Base64
                </button>
                <button class="danger" onclick="clearArchiveBase64()">
                  <span>ğŸ—‘ï¸</span>
                  æ¸…é™¤
                </button>
              </div>

              <!-- <div class="stats-row">
                <div class="stat-item">
                  <strong>æ–‡ä»¶å¤§å°:</strong> <span id="archiveFileSize">0 KB</span>
                </div>
              </div> -->

              <div id="archiveFileInfo" class="file-info">
                <div class="no-file">
                  <div class="file-icon">ğŸ“¦</div>
                  <p>è¯·é€‰æ‹©å‹ç¼©æ–‡ä»¶</p>
                </div>
              </div>

              <div class="info-text">
                <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                1. æ”¯æŒå¸¸è§å‹ç¼©æ ¼å¼ï¼šZIPã€RARã€7Zã€TARã€GZã€BZ2ã€XZ<br>
                2. ä¸Šä¼ åè‡ªåŠ¨è½¬æ¢ä¸ºBase64ï¼Œå¹¶ä¿ç•™åŸå§‹æ–‡ä»¶å<br>
                3. è½¬æ¢çš„Base64åŒ…å«æ–‡ä»¶åä¿¡æ¯ï¼Œè¿˜åŸæ—¶è‡ªåŠ¨ä½¿ç”¨åŸå<br>
                4. æ‰€æœ‰å¤„ç†éƒ½åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨
              </div>
            </div>

            <!-- Base64è½¬å‹ç¼©æ–‡ä»¶ -->
            <div class="tool-section">
              <h3 class="section-title">ğŸ”„ Base64 â†’ å‹ç¼©æ–‡ä»¶</h3>
              
              <textarea id="archiveBase64Input" placeholder="ç²˜è´´å‹ç¼©æ–‡ä»¶çš„Base64ç¼–ç ..."></textarea>
              
              <div class="button-group">
                <button onclick="pasteArchiveBase64()">
                  <span>ğŸ“‹</span>
                  ç²˜è´´Base64
                </button>
                <button onclick="convertBase64ToArchive()">
                  <span>ğŸ”„</span>
                  è½¬æ¢ä¸ºæ–‡ä»¶
                </button>
                <button id="downloadArchiveBtn" class="success" disabled onclick="downloadArchive()">
                  <span>ğŸ’¾</span>
                  ä¸‹è½½æ–‡ä»¶
                </button>
                <button class="danger" onclick="clearArchiveConvert()">
                  <span>ğŸ—‘ï¸</span>
                  æ¸…é™¤
                </button>
              </div>

              <div id="archivePreview" class="file-info">
                <div class="no-file">
                  <div class="file-icon">ğŸ“¦</div>
                  <p>æ–‡ä»¶é¢„è§ˆåŒºåŸŸ</p>
                </div>
              </div>

              <div class="info-text">
                <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                1. ç²˜è´´å‹ç¼©æ–‡ä»¶çš„Base64ç¼–ç ï¼ˆæ”¯æŒè‡ªåŠ¨è¯†åˆ«æ–‡ä»¶åï¼‰<br>
                2. ç‚¹å‡»"è½¬æ¢ä¸ºæ–‡ä»¶"è§£æBase64æ•°æ®<br>
                3. å¦‚æœåŒ…å«æ–‡ä»¶åä¿¡æ¯ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨åŸå§‹æ–‡ä»¶å<br>
                4. ç‚¹å‡»"ä¸‹è½½æ–‡ä»¶"ä¿å­˜åˆ°æœ¬åœ°ï¼Œä¿æŒåŸå§‹æ ¼å¼
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Toastæç¤º -->
    <div id="toast" class="toast"></div>

    <script>
      // å…¨å±€å˜é‡
      let currentImageFile = null;
      let currentArchiveFile = null;
      let currentArchiveFileName = '';
      let currentArchiveFileType = '';

      // å·¥å…·åˆ‡æ¢
      function switchTool(toolId) {
        // æ›´æ–°å¯¼èˆªçŠ¶æ€
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.remove('active');
        });
        event.currentTarget.classList.add('active');

        // æ›´æ–°å†…å®¹åŒºåŸŸ
        document.querySelectorAll('.tool-container').forEach(container => {
          container.classList.remove('active');
        });
        document.getElementById(toolId).classList.add('active');

        // æ›´æ–°æ ‡é¢˜
        const titles = {
          'image-to-base64': {
            title: 'å›¾ç‰‡è½¬æ¢å·¥å…·',
            description: 'æ”¯æŒJPGã€PNGã€GIFç­‰å¸¸è§å›¾ç‰‡æ ¼å¼ä¸Base64ä¹‹é—´çš„ç›¸äº’è½¬æ¢'
          },
          'archive-to-base64': {
            title: 'å‹ç¼©æ–‡ä»¶è½¬æ¢å·¥å…·',
            description: 'æ”¯æŒZIPã€RARã€7Zç­‰å‹ç¼©æ–‡ä»¶æ ¼å¼ä¸Base64ä¹‹é—´çš„ç›¸äº’è½¬æ¢'
          }
        };

        if (titles[toolId]) {
          document.getElementById('current-tool-title').textContent = titles[toolId].title;
          document.getElementById('current-tool-description').textContent = titles[toolId].description;
        }
      }

      // ===== å›¾ç‰‡è½¬æ¢åŠŸèƒ½ =====
      
      // å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ 
      document.getElementById('imageFileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        currentImageFile = file;
        
        showImageFileInfo(file);

        const reader = new FileReader();
        reader.onload = (e) => {
          // ä¸ºå›¾ç‰‡ä¹Ÿåˆ›å»ºåŒ…å«æ–‡ä»¶åçš„Base64æ ¼å¼
          const base64WithFileName = createBase64WithFileName(e.target.result, file.name);
          document.getElementById('imageBase64Output').value = base64WithFileName;
          showToast('å›¾ç‰‡è½¬æ¢æˆåŠŸï¼', 'success');
        };
        reader.readAsDataURL(file);
      });

      // æ˜¾ç¤ºå›¾ç‰‡æ–‡ä»¶ä¿¡æ¯
      function showImageFileInfo(file) {
        const fileInfo = document.getElementById('imageFileInfo');
        const extension = getFileExtension(file.name);
        
        fileInfo.innerHTML = `
          <h3>ğŸ–¼ï¸ å›¾ç‰‡ä¿¡æ¯</h3>
          <div class="file-info-item">
            <strong>æ–‡ä»¶åï¼š</strong>${file.name}
          </div>
          <div class="file-info-item">
            <strong>æ–‡ä»¶å¤§å°ï¼š</strong>${formatFileSize(file.size)}
          </div>
          <div class="file-info-item">
            <strong>æ–‡ä»¶ç±»å‹ï¼š</strong>${extension.toUpperCase()} å›¾ç‰‡
          </div>
          <div class="file-info-item">
            <strong>æœ€åä¿®æ”¹ï¼š</strong>${new Date(file.lastModified).toLocaleString()}
          </div>
        `;
        fileInfo.classList.add('show');
      }

      // ä»å‰ªè´´æ¿ç²˜è´´å›¾ç‰‡
      async function pasteImageFromClipboard() {
        try {
          const clipboardItems = await navigator.clipboard.read();
          for (const clipboardItem of clipboardItems) {
            for (const type of clipboardItem.types) {
              if (type.startsWith('image/')) {
                const blob = await clipboardItem.getType(type);
                
                // åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶å¯¹è±¡
                const file = new File([blob], `clipboard_${Date.now()}.png`, { type: blob.type });
                currentImageFile = file;
                
                showImageFileInfo(file);
                
                const reader = new FileReader();
                reader.onload = (e) => {
                  // ä¸ºç²˜è´´çš„å›¾ç‰‡ä¹Ÿåˆ›å»ºåŒ…å«æ–‡ä»¶åçš„Base64æ ¼å¼
                  const base64WithFileName = createBase64WithFileName(e.target.result, file.name);
                  document.getElementById('imageBase64Output').value = base64WithFileName;
                  showToast('å›¾ç‰‡ç²˜è´´æˆåŠŸï¼', 'success');
                };
                reader.readAsDataURL(blob);
                return;
              }
            }
          }
          showToast('å‰ªè´´æ¿ä¸­æ²¡æœ‰å›¾ç‰‡', 'error');
        } catch (err) {
          console.error('ç²˜è´´å›¾ç‰‡å¤±è´¥:', err);
          showToast('ç²˜è´´å›¾ç‰‡å¤±è´¥ï¼Œè¯·ç¡®ä¿å·²å¤åˆ¶å›¾ç‰‡', 'error');
        }
      }

      // å¤åˆ¶å›¾ç‰‡Base64
      async function copyImageBase64() {
        const output = document.getElementById('imageBase64Output');
        if (!output.value) {
          showToast('æ²¡æœ‰å¯å¤åˆ¶çš„Base64å†…å®¹ï¼', 'error');
          return;
        }
        
        try {
          await navigator.clipboard.writeText(output.value);
          showToast('Base64å¤åˆ¶æˆåŠŸï¼', 'success');
        } catch (err) {
          showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶', 'error');
        }
      }

      // æ¸…é™¤å›¾ç‰‡Base64
      function clearImageBase64() {
        document.getElementById('imageBase64Output').value = '';
        document.getElementById('imageFileInput').value = '';
        document.getElementById('imageFileInfo').classList.remove('show');
        currentImageFile = null;
      }

      // ç²˜è´´å›¾ç‰‡Base64
      async function pasteImageBase64() {
        try {
          const text = await navigator.clipboard.readText();
          document.getElementById('imageBase64Input').value = text;
          showToast('ç²˜è´´æˆåŠŸï¼', 'success');
          convertBase64ToImage();
        } catch (err) {
          showToast('ç²˜è´´å¤±è´¥ï¼Œè¯·ç¡®ä¿å·²å¤åˆ¶Base64å†…å®¹', 'error');
        }
      }

      // Base64è½¬å›¾ç‰‡
      function convertBase64ToImage() {
        const base64Input = document.getElementById('imageBase64Input').value.trim();
        if (!base64Input) {
          showToast('è¯·è¾“å…¥Base64æ–‡æœ¬ï¼', 'error');
          return;
        }

        // å…ˆå°è¯•æå–æ–‡ä»¶å
        const { fileName, base64Data } = extractFileNameFromBase64(base64Input);
        
        if (!base64Data.startsWith('data:image/')) {
          showToast('Base64æ ¼å¼é”™è¯¯ï¼Œè¯·ç¡®ä¿æ˜¯å›¾ç‰‡çš„Base64ç¼–ç ï¼', 'error');
          return;
        }

        const img = document.createElement('img');
        img.src = base64Data;
        img.style.maxWidth = '100%';
        img.style.maxHeight = '300px';
        img.style.borderRadius = '6px';
        
        // ä¿å­˜æ–‡ä»¶åä»¥ä¾›ä¸‹è½½ä½¿ç”¨
        window.currentImageFileName = fileName;
        
        img.onload = () => {
          const preview = document.getElementById('imagePreview');
          const fileNameInfo = fileName ? `<div class="file-info-item"><strong>åŸå§‹æ–‡ä»¶åï¼š</strong>${fileName}</div>` : '';
          preview.innerHTML = `
            <h3>ğŸ–¼ï¸ å›¾ç‰‡é¢„è§ˆ</h3>
            ${fileNameInfo}
            <div style="text-align: center; margin-top: 15px;">
              ${img.outerHTML}
            </div>
          `;
          preview.classList.add('show');
          document.getElementById('downloadImageBtn').disabled = false;
          showToast('å›¾ç‰‡è½¬æ¢æˆåŠŸï¼', 'success');
        };
        
        img.onerror = () => {
          showToast('Base64æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥ï¼', 'error');
          document.getElementById('downloadImageBtn').disabled = true;
        };
      }

      // ä¸‹è½½å›¾ç‰‡
      function downloadImage() {
        const base64Input = document.getElementById('imageBase64Input').value.trim();
        if (!base64Input) return;

        // æå–å®é™…çš„Base64æ•°æ®ï¼ˆå»é™¤æ–‡ä»¶åä¿¡æ¯ï¼‰
        const { fileName, base64Data } = extractFileNameFromBase64(base64Input);

        const link = document.createElement('a');
        link.href = base64Data;
        
        // ä½¿ç”¨æå–çš„æ–‡ä»¶åæˆ–ç”Ÿæˆé»˜è®¤æ–‡ä»¶å
        if (fileName) {
          link.download = fileName;
          showToast(`ä½¿ç”¨åŸå§‹æ–‡ä»¶åä¸‹è½½: ${fileName}`, 'success');
        } else {
          // æ ¹æ®MIMEç±»å‹ç¡®å®šæ–‡ä»¶æ‰©å±•å
          const mimeMatch = base64Data.match(/data:image\/([^;]+)/);
          const extension = mimeMatch ? mimeMatch[1] : 'png';
          link.download = `image_${Date.now()}.${extension}`;
          showToast('å›¾ç‰‡ä¸‹è½½å¼€å§‹ï¼', 'success');
        }
        
        link.click();
      }

      // æ¸…é™¤å›¾ç‰‡è½¬æ¢
      function clearImageConvert() {
        document.getElementById('imageBase64Input').value = '';
        document.getElementById('imagePreview').innerHTML = `
          <div class="no-file">
            <div class="file-icon">ğŸ–¼ï¸</div>
            <p>å›¾ç‰‡é¢„è§ˆåŒºåŸŸ</p>
          </div>
        `;
        document.getElementById('downloadImageBtn').disabled = true;
      }

      // ===== å‹ç¼©æ–‡ä»¶è½¬æ¢åŠŸèƒ½ =====

      // å‹ç¼©æ–‡ä»¶ä¸Šä¼ 
      document.getElementById('archiveFileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        currentArchiveFile = file;
        currentArchiveFileName = file.name;
        currentArchiveFileType = file.type || getFileTypeByExtension(file.name);

        // document.getElementById('archiveFileSize').textContent = formatFileSize(file.size);
        showArchiveFileInfo(file);

        const reader = new FileReader();
        reader.onload = (e) => {
          const base64WithFileName = createBase64WithFileName(e.target.result, file.name);
          document.getElementById('archiveBase64Output').value = base64WithFileName;
          showToast('æ–‡ä»¶è½¬æ¢æˆåŠŸï¼', 'success');
        };
        reader.readAsDataURL(file);
      });

      // æ˜¾ç¤ºå‹ç¼©æ–‡ä»¶ä¿¡æ¯
      function showArchiveFileInfo(file) {
        const fileInfo = document.getElementById('archiveFileInfo');
        const extension = getFileExtension(file.name);
        const icon = getFileIcon(extension);
        
        fileInfo.innerHTML = `
          <h3>${icon} æ–‡ä»¶ä¿¡æ¯</h3>
          <div class="file-info-item">
            <strong>æ–‡ä»¶åï¼š</strong>${file.name}
          </div>
          <div class="file-info-item">
            <strong>æ–‡ä»¶å¤§å°ï¼š</strong>${formatFileSize(file.size)}
          </div>
          <div class="file-info-item">
            <strong>æ–‡ä»¶ç±»å‹ï¼š</strong>${extension.toUpperCase()} å‹ç¼©æ–‡ä»¶
          </div>
          <div class="file-info-item">
            <strong>æœ€åä¿®æ”¹ï¼š</strong>${new Date(file.lastModified).toLocaleString()}
          </div>
        `;
        fileInfo.classList.add('show');
      }

      // å¤åˆ¶å‹ç¼©æ–‡ä»¶Base64
      async function copyArchiveBase64() {
        const output = document.getElementById('archiveBase64Output');
        if (!output.value) {
          showToast('æ²¡æœ‰å¯å¤åˆ¶çš„Base64å†…å®¹ï¼', 'error');
          return;
        }
        
        try {
          await navigator.clipboard.writeText(output.value);
          showToast('Base64å¤åˆ¶æˆåŠŸï¼', 'success');
        } catch (err) {
          showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶', 'error');
        }
      }

      // æ¸…é™¤å‹ç¼©æ–‡ä»¶Base64
      function clearArchiveBase64() {
        document.getElementById('archiveBase64Output').value = '';
        document.getElementById('archiveFileInput').value = '';
        // document.getElementById('archiveFileSize').textContent = '0 KB';
        document.getElementById('archiveFileInfo').classList.remove('show');
        currentArchiveFile = null;
        currentArchiveFileName = '';
        currentArchiveFileType = '';
      }

      // ç²˜è´´å‹ç¼©æ–‡ä»¶Base64
      async function pasteArchiveBase64() {
        try {
          const text = await navigator.clipboard.readText();
          document.getElementById('archiveBase64Input').value = text;
          showToast('ç²˜è´´æˆåŠŸï¼', 'success');
          convertBase64ToArchive();
        } catch (err) {
          showToast('ç²˜è´´å¤±è´¥ï¼Œè¯·ç¡®ä¿å·²å¤åˆ¶Base64å†…å®¹', 'error');
        }
      }

      // Base64è½¬å‹ç¼©æ–‡ä»¶
      function convertBase64ToArchive() {
        const base64Input = document.getElementById('archiveBase64Input').value.trim();
        if (!base64Input) {
          showToast('è¯·è¾“å…¥Base64æ–‡æœ¬ï¼', 'error');
          return;
        }

        try {
          const { fileName, base64Data } = extractFileNameFromBase64(base64Input);
          
          if (!base64Data.startsWith('data:')) {
            showToast('Base64æ ¼å¼é”™è¯¯ï¼Œè¯·ç¡®ä¿åŒ…å«å®Œæ•´çš„data:å‰ç¼€ï¼', 'error');
            return;
          }

          const mimeMatch = base64Data.match(/data:([^;]+)/);
          const mimeType = mimeMatch ? mimeMatch[1] : 'application/octet-stream';
          
          if (fileName) {
            currentArchiveFileName = fileName;
            showToast(`æ£€æµ‹åˆ°åŸå§‹æ–‡ä»¶å: ${fileName}`, 'success');
          } else {
            const extension = getExtensionFromMimeType(mimeType);
            currentArchiveFileName = `file_${Date.now()}.${extension}`;
          }
          currentArchiveFileType = mimeType;

          showArchivePreview(base64Data, mimeType, getFileExtension(currentArchiveFileName));
          
          document.getElementById('downloadArchiveBtn').disabled = false;
          showToast('Base64è§£ææˆåŠŸï¼', 'success');
        } catch (error) {
          showToast('Base64æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥ï¼', 'error');
          document.getElementById('downloadArchiveBtn').disabled = true;
        }
      }

      // æ˜¾ç¤ºå‹ç¼©æ–‡ä»¶é¢„è§ˆ
      function showArchivePreview(base64Data, mimeType, extension) {
        const preview = document.getElementById('archivePreview');
        const icon = getFileIcon(extension);
        
        const base64Size = Math.round((base64Data.length * 3) / 4);
        
        preview.innerHTML = `
          <h3>${icon} æ–‡ä»¶é¢„è§ˆ</h3>
          <div class="file-info-item">
            <strong>æ–‡ä»¶åï¼š</strong>${currentArchiveFileName}
          </div>
          <div class="file-info-item">
            <strong>é¢„ä¼°å¤§å°ï¼š</strong>${formatFileSize(base64Size)}
          </div>
          <div class="file-info-item">
            <strong>æ–‡ä»¶ç±»å‹ï¼š</strong>${extension.toUpperCase()} å‹ç¼©æ–‡ä»¶
          </div>
          <div class="file-info-item">
            <strong>MIMEç±»å‹ï¼š</strong>${mimeType}
          </div>
        `;
        preview.classList.add('show');
      }

      // ä¸‹è½½å‹ç¼©æ–‡ä»¶
      function downloadArchive() {
        const base64Input = document.getElementById('archiveBase64Input').value.trim();
        if (!base64Input) return;

        try {
          const { base64Data } = extractFileNameFromBase64(base64Input);
          
          const link = document.createElement('a');
          link.href = base64Data;
          link.download = currentArchiveFileName;
          link.click();
          showToast('æ–‡ä»¶ä¸‹è½½å¼€å§‹ï¼', 'success');
        } catch (error) {
          showToast('ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥Base64æ ¼å¼ï¼', 'error');
        }
      }

      // æ¸…é™¤å‹ç¼©æ–‡ä»¶è½¬æ¢
      function clearArchiveConvert() {
        document.getElementById('archiveBase64Input').value = '';
        document.getElementById('archivePreview').innerHTML = `
          <div class="no-file">
            <div class="file-icon">ğŸ“¦</div>
            <p>æ–‡ä»¶é¢„è§ˆåŒºåŸŸ</p>
          </div>
        `;
        document.getElementById('downloadArchiveBtn').disabled = true;
        currentArchiveFileName = '';
        currentArchiveFileType = '';
      }

      // ===== é€šç”¨å·¥å…·å‡½æ•° =====

      // åˆ›å»ºåŒ…å«æ–‡ä»¶åçš„Base64æ ¼å¼
      function createBase64WithFileName(base64Data, fileName) {
        const fileNameBase64 = btoa(encodeURIComponent(fileName));
        return `FILENAME:${fileNameBase64}|${base64Data}`;
      }

      // ä»Base64æ•°æ®ä¸­æå–æ–‡ä»¶å
      function extractFileNameFromBase64(base64Data) {
        if (base64Data.startsWith('FILENAME:')) {
          const parts = base64Data.split('|');
          if (parts.length >= 2) {
            const fileNameBase64 = parts[0].replace('FILENAME:', '');
            try {
              const fileName = decodeURIComponent(atob(fileNameBase64));
              const actualBase64 = parts.slice(1).join('|');
              return { fileName, base64Data: actualBase64 };
            } catch (e) {
              console.error('è§£ææ–‡ä»¶åå¤±è´¥:', e);
            }
          }
        }
        return { fileName: null, base64Data: base64Data };
      }

      // è·å–æ–‡ä»¶æ‰©å±•å
      function getFileExtension(filename) {
        return filename.split('.').pop().toLowerCase();
      }

      // æ ¹æ®æ‰©å±•åè·å–æ–‡ä»¶ç±»å‹
      function getFileTypeByExtension(filename) {
        const ext = getFileExtension(filename);
        const typeMap = {
          'zip': 'application/zip',
          'rar': 'application/x-rar-compressed',
          '7z': 'application/x-7z-compressed',
          'tar': 'application/x-tar',
          'gz': 'application/gzip',
          'bz2': 'application/x-bzip2',
          'xz': 'application/x-xz'
        };
        return typeMap[ext] || 'application/octet-stream';
      }

      // æ ¹æ®MIMEç±»å‹è·å–æ‰©å±•å
      function getExtensionFromMimeType(mimeType) {
        const typeMap = {
          'application/zip': 'zip',
          'application/x-rar-compressed': 'rar',
          'application/x-7z-compressed': '7z',
          'application/x-tar': 'tar',
          'application/gzip': 'gz',
          'application/x-bzip2': 'bz2',
          'application/x-xz': 'xz'
        };
        return typeMap[mimeType] || 'zip';
      }

      // è·å–æ–‡ä»¶å›¾æ ‡
      function getFileIcon(extension) {
        const iconMap = {
          'zip': 'ğŸ—œï¸',
          'rar': 'ğŸ“¦',
          '7z': 'ğŸ—ƒï¸',
          'tar': 'ğŸ“',
          'gz': 'ğŸ—œï¸',
          'bz2': 'ğŸ“¦',
          'xz': 'ğŸ—ƒï¸'
        };
        return iconMap[extension] || 'ğŸ“„';
      }

      // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
      function formatFileSize(bytes) {
        if (bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }

      // Toastæç¤º
      function showToast(message, type = 'info') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast ${type}`;
        toast.classList.add('show');

        setTimeout(() => {
          toast.classList.remove('show');
        }, 3000);
      }
    </script>
  </body>
</html>